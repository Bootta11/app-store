services:
  "{{STACK_NAME}}_postgres":
    image: postgres
    environment:
      - "POSTGRES_USER={{POSTGRES_USER}}"
      - "POSTGRES_PASSWORD={{POSTGRES_PASSWORD}}"

  "{{STACK_NAME}}_pgbackups3":
    image: schickling/postgres-backup-s3
    links:
      - "{{STACK_NAME}}_postgres:postgres"
    environment:
      - "SCHEDULE={{SCHEDULE}}"
      - "S3_REGION={{S3_REGION}}"
      - "S3_ACCESS_KEY_ID={{S3_ACCESS_KEY_ID}}"
      - "S3_SECRET_ACCESS_KEY={{S3_SECRET_ACCESS_KEY}}"
      - "S3_BUCKET={{S3_BUCKET}}"
      - "S3_PREFIX={{S3_PREFIX}}"
      - "POSTGRES_DATABASE={{POSTGRES_DATABASE}}"
      - "POSTGRES_USER={{POSTGRES_USER}}"
      - "POSTGRES_PASSWORD={{POSTGRES_PASSWORD}}"
      - "POSTGRES_EXTRA_OPTS={{POSTGRES_EXTRA_OPTS}}"
docs:
  logo_url: "https://example.com/path_to_postgres_backup_s3_logo.png"
  name: "Postgres Backup S3"
  description: "Secure and reliable PostgreSQL backups to S3 with periodic scheduling."
  readme_description: >
    ### What is Postgres Backup S3?

    Postgres Backup S3 allows for secure and automated backups of PostgreSQL databases directly to S3 storage, supporting flexible scheduling options.

    ### Usage

    - Set up periodic backups with customizable schedules.
    - Configure PostgreSQL and S3 credentials directly through environment variables.

    ### Links

    - More information on scheduling - [postgres-backup-s3-scheduling](https://postgres-backup-s3-docs.com/scheduling)

  iframe_video_embed: ""
  variables:
    SCHEDULE:
      title: "Backup Schedule"
      description: "Cron schedule for automated backups"
      default: "@daily"
      type: text
    S3_REGION:
      title: "AWS S3 Region"
      description: "AWS region where the S3 bucket is located"
      default: "us-east-1"
      type: text
    S3_ACCESS_KEY_ID:
      title: "AWS S3 Access Key ID"
      description: "Access key ID for AWS S3"
      default: ""
      type: text
    S3_SECRET_ACCESS_KEY:
      title: "AWS S3 Secret Access Key"
      description: "Secret access key for AWS S3"
      default: ""
      type: text
    S3_BUCKET:
      title: "S3 Bucket Name"
      description: "Name of the S3 bucket where backups will be stored"
      default: ""
      type: text
    S3_PREFIX:
      title: "S3 Prefix"
      description: "Prefix path under the S3 bucket where backups will be stored"
      default: "backup"
      type: text
    POSTGRES_DATABASE:
      title: "PostgreSQL Database Name"
      description: "Name of the PostgreSQL database to backup"
      default: ""
      type: text
    POSTGRES_USER:
      title: "PostgreSQL User"
      description: "Username for accessing the PostgreSQL database"
      default: ""
      type: text
    POSTGRES_PASSWORD:
      title: "PostgreSQL Password"
      description: "Password for the specified PostgreSQL user"
      default: ""
      type: text
    POSTGRES_EXTRA_OPTS:
      title: "Additional pg_dump Options"
      description: "Extra options to pass to pg_dump, such as schema selection or blob handling"
      default: "--schema=public --blobs"
      type: text
